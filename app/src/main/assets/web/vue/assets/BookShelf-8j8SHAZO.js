import{a0 as $,m as y,o as l,d as p,g as t,F as U,M as W,t as m,c as q,w as M,f as V,J as L,u as J,a1 as H,a2 as G,e as E,I as X,p as N,v as T,a3 as j,L as ee,a4 as te,Q as se,j as k,y as oe,D as ae,a5 as ne}from"./vendor-JTttPx12.js";import{d as re,i as ie,u as ce}from"./loading-DbywvlSa.js";import{_ as x,A as v,u as le,l as D,v as de,s as ue}from"./index-BPmSTa9M.js";const he={class:"books-wrapper"},ge={class:"wrapper"},pe=["onClick"],me={class:"cover-img"},fe=["src"],ve={class:"info"},we={class:"name"},Be={class:"sub"},Ce={class:"author"},ke={key:0,class:"tags"},ye={key:1,class:"update-info"},Se={class:"size"},Ae={class:"date"},Ie={key:0,class:"intro"},Re={key:1,class:"dur-chapter"},_e={class:"last-chapter"},Le={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(e,{emit:r}){$(a=>({"6068553a":J(C)}));const c=e,f=r,B=a=>f("bookClick",a),w=a=>ie(a)?v.getProxyCoverUrl(a):a,S=a=>{a.target.src=v.getProxyCoverUrl(a.target.src)},C=y(()=>c.isSearch?"space-between":"flex-start");return(a,d)=>{const u=H;return l(),p("div",he,[t("div",ge,[(l(!0),p(U,null,W(e.books,n=>{var A;return l(),p("div",{class:"book",key:n.bookUrl,onClick:I=>B(n)},[t("div",me,[(l(),p("img",{class:"cover",src:w(n.coverUrl),key:n.coverUrl,onErrorOnce:S,alt:"",loading:"lazy"},null,40,fe))]),t("div",ve,[t("div",we,m(n.name),1),t("div",Be,[t("div",Ce,m(n.author),1),e.isSearch?(l(),p("div",ke,[(l(!0),p(U,null,W((A=n.kind)==null?void 0:A.split(",").slice(0,2),I=>(l(),q(u,{key:I},{default:M(()=>[V(m(I),1)]),_:2},1024))),128))])):L("",!0),e.isSearch?L("",!0):(l(),p("div",ye,[d[0]||(d[0]=t("div",{class:"dot"},"•",-1)),t("div",Se,"共"+m(n.totalChapterNum)+"章",1),d[1]||(d[1]=t("div",{class:"dot"},"•",-1)),t("div",Ae,m(J(re)(n.lastCheckTime)),1)]))]),e.isSearch?(l(),p("div",Ie,m(n.intro),1)):L("",!0),e.isSearch?L("",!0):(l(),p("div",Re," 已读："+m(n.durChapterTitle),1)),t("div",_e,"最新："+m(n.latestChapterTitle),1)])],8,pe)}),128))])])}}},Ee=x(Le,[["__scopeId","data-v-136fc284"]]),Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Ne=G({beforeRouteEnter:(e,r,c)=>{v.getReadConfig().then(f=>f.data).then(({isSuccess:f,data:B})=>{f?c(w=>{w.saveReadConfig(B)}):c()}).catch(()=>c())},setup:()=>{const e=le(),r=y(()=>e.isNight),c=T({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0,isSeachBook:!1}),f=T(null),{showLoading:B,closeLoading:w,loadingWrapper:S,isLoading:C}=ce(f,"正在获取书籍信息"),a=j([]),d=y(()=>e.shelf),u=T(""),n=T(!1);ee(()=>{if(!(n.value&&u.value!="")){if(n.value=!1,a.value=[],u.value==""){a.value=d.value;return}a.value=d.value.filter(s=>s.name.includes(u.value)||s.author.includes(u.value))}});const A=()=>{u.value!=""&&(a.value=[],e.clearSearchBooks(),B(),n.value=!0,v.search(u.value,s=>{C&&w();try{e.setSearchBooks(JSON.parse(s)),a.value=e.searchBooks}catch(o){throw k.error("后端数据错误"),o}},()=>{w(),a.value.length==0&&k.info("搜索结果为空")}))},I=y(()=>e.connectStatus),O=y(()=>e.connectType),Z=y(()=>e.newConnect),F=()=>{ne.prompt("请输入 后端地址 ( 如：http://127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:D,inputValidator:s=>{var o;try{de(s)}catch(i){return((o=i==null?void 0:i.cause)==null?void 0:o.message)??i.message}return!0},beforeClose:(s,o,i)=>{if(s==="confirm"){e.setNewConnect(!0),o.confirmButtonLoading=!0,o.confirmButtonText="校验中……";const h=new URL(o.inputValue);v.testLeagdoHttpUrlConnection(h).then(function(g){z(g),o.confirmButtonLoading=!1,e.setConnectType("success"),e.clearSearchBooks(),e.setNewConnect(!1),ue(h),e.setConnectStatus("已连接 "+h.toString()),P(),i()}).catch(function(g){throw o.confirmButtonLoading=!1,o.confirmButtonText="确定",k.error("访问失败，请检查您输入的 url"),e.setNewConnect(!1),g})}else i()}})},K=te(),Y=async s=>{const{bookUrl:o,name:i,author:h,durChapterIndex:g=0,durChapterPos:R=0}=s,_="respondTime"in s;_&&await v.saveBook(s),b(o,i,h,g,R,_)},b=(s,o,i,h,g,R,_=!1)=>{if(o!=="尚无阅读记录"){if(R===!0&&_){u.value=o,A();return}sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",o),sessionStorage.setItem("bookAuthor",i),sessionStorage.setItem("chapterIndex",h),sessionStorage.setItem("chapterPos",g),sessionStorage.setItem("isSeachBook",String(R)),c.value={name:o,author:i,url:s,chapterIndex:h,chapterPos:g,isSeachBook:R},localStorage.setItem("readingRecent",JSON.stringify(c.value)),K.push({path:"/chapter"})}},Q=()=>{S(e.saveBookProgress().finally(P))},z=s=>{try{e.setConfig(JSON.parse(s))}catch{k.info("阅读界面配置解析错误")}},P=()=>v.getBookShelf().then(s=>{e.setConnectType("success"),s.data.isSuccess?e.addBooks(s.data.data.sort(function(o,i){var h=o.durChapterTime||0,g=i.durChapterTime||0;return g-h})):k.error(s.data.errorMsg??"后端返回格式错误！"),e.setConnectStatus("已连接 "+D),e.setNewConnect(!1)});return se(()=>{let s=localStorage.getItem("readingRecent");s!=null&&(c.value=JSON.parse(s),typeof c.value.chapterIndex>"u"&&(c.value.chapterIndex=0)),v.testLeagdoHttpUrlConnection().then(Q).catch(function(o){throw e.setConnectType("danger"),e.setConnectStatus("连接异常"),k.error("后端连接失败异常，请检查阅读WEB服务或者设置其它可用链接"),e.setNewConnect(!1),o})}),{setLegadoRetmoteUrl:F,isNight:r,connectStatus:I,connectType:O,newConnect:Z,saveReadConfig:z,readingRecent:c,searchBook:A,books:a,handleBookClick:Y,toDetail:b,isSearching:n,SearchIcon:oe,githubUrl:Te,searchWord:u}}}),Me={class:"navigation-wrapper"},Ve={class:"search-wrapper"},be={class:"bottom-wrapper"},ze={class:"recent-wrapper"},Pe={class:"reading-recent"},Ue={class:"setting-wrapper"},We={class:"setting-item"},Je={class:"bottom-icons"},De={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},He={class:"bottom-icon"},xe=["src"],Oe={class:"shelf-wrapper",ref:"shelfWrapper"};function Ze(e,r,c,f,B,w){const S=ae,C=H,a=Ee;return l(),p("div",{class:N({"index-wrapper":!0,night:e.isNight,day:!e.isNight})},[t("div",Me,[r[4]||(r[4]=t("div",{class:"navigation-title-wrapper"},[t("div",{class:"navigation-title"},"阅读"),t("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),t("div",Ve,[E(S,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:e.searchWord,"onUpdate:modelValue":r[0]||(r[0]=d=>e.searchWord=d),class:"search-input","prefix-icon":e.SearchIcon,onKeyup:X(e.searchBook,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),t("div",be,[t("div",ze,[r[2]||(r[2]=t("div",{class:"recent-title"},"最近阅读",-1)),t("div",Pe,[E(C,{type:e.readingRecent.name=="尚无阅读记录"?"warning":"primary",class:N(["recent-book",{"no-point":e.readingRecent.url==""}]),size:"large",onClick:r[1]||(r[1]=d=>e.toDetail(e.readingRecent.url,e.readingRecent.name,e.readingRecent.author,e.readingRecent.chapterIndex,e.readingRecent.chapterPos,e.readingRecent.isSeachBook,!0))},{default:M(()=>[V(m(e.readingRecent.name),1)]),_:1},8,["type","class"])])]),t("div",Ue,[r[3]||(r[3]=t("div",{class:"setting-title"},"基本设定",-1)),t("div",We,[E(C,{type:e.connectType,size:"large",class:N(["setting-connect",{"no-point":e.newConnect}]),onClick:e.setLegadoRetmoteUrl},{default:M(()=>[V(m(e.connectStatus),1)]),_:1},8,["type","class","onClick"])])])]),t("div",Je,[t("a",De,[t("div",He,[t("img",{src:e.githubUrl,alt:""},null,8,xe)])])])]),t("div",Oe,[E(a,{books:e.books,onBookClick:e.handleBookClick,isSearch:e.isSearching},null,8,["books","onBookClick","isSearch"])],512)],2)}const Qe=x(Ne,[["render",Ze],["__scopeId","data-v-c7b150b3"]]);export{Qe as default};
